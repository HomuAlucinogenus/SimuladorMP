<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Vendas 3.0 - Mercado Pago</title>
    <style>
        :root {
            --mp-yellow: rgb(255, 230, 0); --mp-blue: rgb(0, 150, 250); --white: rgb(255, 255, 255);
            --background-light: #f4f6f9; --text-dark: #333; --text-light: #666;
            --border-color: #e0e0e0; --danger-text: #d9534f; --success-text: #28a745;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: var(--background-light); color: var(--text-dark); display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 20px; }
        .container { width: 100%; max-width: 800px; background-color: var(--white); padding: 30px; border-radius: 16px; box-shadow: 0 8px 40px rgba(0,0,0,0.08); }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid var(--mp-yellow); padding-bottom: 15px; }
        .header img { max-width: 200px; margin-bottom: 15px; cursor: pointer; }
        h1 { color: var(--text-dark); font-size: 1.5em; font-weight: 700; }
        h1 span { color: var(--mp-blue); }
        .input-group { margin-bottom: 25px; }
        .input-group label { display: block; font-weight: 600; margin-bottom: 8px; }
        .input-group input[type="number"] { width: 100%; padding: 14px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1.5em; text-align: center; color: var(--mp-blue); font-weight: 700; }
        .input-group input:focus { outline: none; border-color: var(--mp-blue); box-shadow: 0 0 0 3px rgba(0, 150, 250, 0.2); }
        .input-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 10px; }
        .rate-input { text-align: center; flex-shrink: 0; }
        .rate-input label { font-size: 0.9em; font-weight: 500; color: var(--text-dark); }
        .rate-input input { font-size: 1em; padding: 10px; font-weight: normal; width: 110px; }
        .section-title { font-weight: 700; font-size: 1.2em; color: var(--text-dark); margin-top: 30px; margin-bottom: 15px; border-bottom: 2px solid var(--border-color); padding-bottom: 8px; }
        .toggle-competitor { display: flex; align-items: center; justify-content: center; margin: 20px 0; font-size: 1.1em; font-weight: 600; color: var(--mp-blue); cursor: pointer; }
        .toggle-competitor input { margin-right: 10px; width: 18px; height: 18px; }
        #competitor-section { display: none; }
        #simulation-output { margin-top: 30px; display: none; flex-direction: column; gap: 20px; }
        #simulationTitle { font-size: 1.6em; font-weight: 700; text-align: center; margin-bottom: 5px; }
        .result-card { background-color: var(--white); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; overflow: hidden; }
        .result-card h3 { font-size: 1.2em; color: var(--mp-blue); margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .result-table { width: 100%; border-collapse: collapse; }
        .result-table th { text-align: left; padding: 8px 5px; font-size: 0.85em; color: #333; border-bottom: 2px solid rgba(0,0,0,0.1); }
        .result-table th.align-right { text-align: right; }
        .result-table td { padding: 10px 5px; border-bottom: 1px solid rgba(0,0,0,0.05); font-size: 0.95em; }
        .result-table tr:last-child td { border-bottom: none; }
        .result-label { font-weight: 500; }
        .result-value { font-weight: bold; font-size: 1.05em; text-align: right; }
        .result-value.difference { font-size: 0.95em; color: var(--success-text); }
        .highlight { color: var(--mp-blue); } .total-value { color: var(--mp-blue); }
        .interest-value { color: var(--danger-text); font-size: 0.9em; display: block; }

        /* --- CSS DO EASTER EGG --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: var(--white); padding: 25px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .modal-content h2 { color: var(--mp-blue); margin-bottom: 20px; text-align: center; }
        #profiles-list { list-style: none; margin-bottom: 20px; max-height: 300px; overflow-y: auto; }
        #profiles-list li { display: flex; justify-content: space-between; align-items: center; padding: 12px 5px; border-bottom: 1px solid var(--border-color); }
        #profiles-list li:last-child { border-bottom: none; }
        #profiles-list .profile-name { font-weight: 600; }
        #profiles-list .profile-actions button { padding: 6px 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; margin-left: 8px; }
        #profiles-list .load-btn { background-color: var(--mp-blue); color: white; }
        #profiles-list .delete-btn { background-color: var(--danger-text); color: white; }
        #close-menu-btn { width: 100%; padding: 12px; background-color: #6c757d; color: white; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="mercado-pago-logo.png" alt="Mercado Pago Logo" id="mp-logo">
            <h1>Simulador de Vendas <span>2.0</span></h1>
        </div>

        <div id="input-section">
            <div class="input-group">
                <label for="saleValue">Valor da Venda (R$)</label>
                <input type="number" id="saleValue" value="1000" onkeyup="calculate()">
            </div>
            <p class="section-title">Mercado Pago</p>
            <div class="input-grid">
                <div class="rate-input"><label for="mp_pixRate">Pix (%)</label><input type="number" id="mp_pixRate" value="0.99" step="0.01" onkeyup="calculate()"></div>
                <div class="rate-input"><label for="mp_creditRate">Crédito à Vista (%)</label><input type="number" id="mp_creditRate" value="4.98" step="0.01" onkeyup="calculate()"></div>
                <div class="rate-input"><label for="mp_debitRate">Débito (%)</label><input type="number" id="mp_debitRate" value="1.99" step="0.01" onkeyup="calculate()"></div>
            </div>
            <div class="input-grid" style="margin-top: 20px;">
                <div class="rate-input"><label for="mp_procFee_2_6">2x a 6x</label><input type="number" id="mp_procFee_2_6" value="2.00" step="0.01" onkeyup="calculate()"></div>
                <div class="rate-input"><label for="mp_procFee_7_12">7x a 12x</label><input type="number" id="mp_procFee_7_12" value="3.60" step="0.01" onkeyup="calculate()"></div>
                <div class="rate-input"><label for="mp_procFee_13_18">13x a 18x</label><input type="number" id="mp_procFee_13_18" value="3.60" step="0.01" onkeyup="calculate()"></div>
                <div class="rate-input"><label for="mp_psj_2_12">PSJ (2x a 12x)</label><input type="number" id="mp_psj_2_12" value="0.90" step="0.01" onkeyup="calculate()"></div>
                <div class="rate-input"><label for="mp_psj_13_18">PSJ (13x a 18x)</label><input type="number" id="mp_psj_13_18" value="1.30" step="0.01" onkeyup="calculate()"></div>
            </div>
            <div class="toggle-competitor"><input type="checkbox" id="compare-toggle" onchange="toggleCompetitorSection()"><label for="compare-toggle">Comparar com Concorrência</label></div>
            <div id="competitor-section">
                 <p class="section-title">Concorrência</p>
                <div class="input-grid">
                    <div class="rate-input"><label for="c_pixRate">Pix (%)</label><input type="number" id="c_pixRate" value="1.20" step="0.01" onkeyup="calculate()"></div>
                    <div class="rate-input"><label for="c_creditRate">Crédito à Vista (%)</label><input type="number" id="c_creditRate" value="5.50" step="0.01" onkeyup="calculate()"></div>
                    <div class="rate-input"><label for="c_debitRate">Débito (%)</label><input type="number" id="c_debitRate" value="2.20" step="0.01" onkeyup="calculate()"></div>
                </div>
                <div class="input-grid" style="margin-top: 20px;">
                    <div class="rate-input"><label for="c_procFee_2_6">2x a 6x</label><input type="number" id="c_procFee_2_6" value="3.00" step="0.01" onkeyup="calculate()"></div>
                    <div class="rate-input"><label for="c_procFee_7_12">7x a 12x</label><input type="number" id="c_procFee_7_12" value="4.00" step="0.01" onkeyup="calculate()"></div>
                    <div class="rate-input"><label for="c_procFee_13_18">13x a 18x</label><input type="number" id="c_procFee_13_18" value="4.50" step="0.01" onkeyup="calculate()"></div>
                    <div class="rate-input"><label for="c_psj_2_12">PSJ (2x a 12x)</label><input type="number" id="c_psj_2_12" value="1.99" step="0.01" onkeyup="calculate()"></div>
                    <div class="rate-input"><label for="c_psj_13_18">PSJ (13x a 18x)</label><input type="number" id="c_psj_13_18" value="2.50" step="0.01" onkeyup="calculate()"></div>
                </div>
            </div>
        </div>

        <div id="simulation-output">
            <h2 id="simulationTitle"></h2>
            <div class="result-card"><h3 >Vendas à Vista</h3><table class="result-table" id="spot-sales-table"></table></div>
            <div class="result-card"><h3>Cenário 1: VENDEDOR Paga a Taxa (PSJ)</h3><table class="result-table"><thead><tr id="psj-table-header"></tr></thead><tbody id="psj-table-body"></tbody></table></div>
            <div class="result-card"><h3>Cenário 2: CLIENTE Paga a Taxa (PCJ)</h3><table class="result-table"><thead><tr id="pcj-table-header"></tr></thead><tbody id="pcj-table-body"></tbody></table></div>
        </div>
    </div>

    <div id="easter-egg-menu" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Perfis de Taxas Salvos</h2>
            <ul id="profiles-list"></ul>
            <button id="close-menu-btn">Fechar</button>
        </div>
    </div>

    <script>
        // --- LÓGICA DO EASTER EGG ---
        let clickCount = 0;
        let clickTimer = null;
        const rateProfileIds = [
            'mp_pixRate', 'mp_creditRate', 'mp_debitRate', 'mp_procFee_2_6', 'mp_procFee_7_12',
            'mp_procFee_13_18', 'mp_psj_2_12', 'mp_psj_13_18'
        ];

        document.getElementById('mp-logo').addEventListener('click', () => {
            clickCount++;
            clearTimeout(clickTimer);
            if (clickCount === 3) {
                clickCount = 0;
                activateEasterEgg();
            } else {
                clickTimer = setTimeout(() => { clickCount = 0; }, 500); // Reseta se não clicar rápido
            }
        });

        function activateEasterEgg() {
            const profileName = prompt("Digite um nome para este perfil de taxas:");
            if (profileName) {
                saveProfile(profileName);
            }
            renderMenu();
            toggleMenu(true);
        }
        
        function getProfiles() { return JSON.parse(localStorage.getItem('mp_rate_profiles')) || []; }
        function setProfiles(profiles) { localStorage.setItem('mp_rate_profiles', JSON.stringify(profiles)); }

        function saveProfile(name) {
            const rates = {};
            rateProfileIds.forEach(id => { rates[id] = document.getElementById(id).value; });
            const newProfile = { name, rates };
            const profiles = getProfiles();
            profiles.push(newProfile);
            setProfiles(profiles);
        }

        function loadProfile(index) {
            const profiles = getProfiles();
            const profile = profiles[index];
            if (profile) {
                rateProfileIds.forEach(id => { document.getElementById(id).value = profile.rates[id]; });
                calculate();
                toggleMenu(false);
            }
        }

        function deleteProfile(index) {
            if (confirm("Tem certeza que deseja deletar este perfil?")) {
                const profiles = getProfiles();
                profiles.splice(index, 1);
                setProfiles(profiles);
                renderMenu();
            }
        }

        function renderMenu() {
            const profiles = getProfiles();
            const list = document.getElementById('profiles-list');
            list.innerHTML = '';
            if (profiles.length === 0) {
                list.innerHTML = '<li><span class="profile-name">Nenhum perfil salvo ainda.</span></li>';
                return;
            }
            profiles.forEach((profile, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span class="profile-name">${profile.name}</span>
                    <span class="profile-actions">
                        <button class="load-btn" onclick="loadProfile(${index})">Carregar</button>
                        <button class="delete-btn" onclick="deleteProfile(${index})">Deletar</button>
                    </span>
                `;
                list.appendChild(li);
            });
        }

        function toggleMenu(show) {
            const menu = document.getElementById('easter-egg-menu');
            menu.style.display = show ? 'flex' : 'none';
        }
        document.getElementById('close-menu-btn').addEventListener('click', () => toggleMenu(false));
        
        // --- LÓGICA PRINCIPAL DO SIMULADOR ---
        // (código anterior mantido aqui, sem alterações)
        function formatCurrency(value) {
            if (isNaN(value) || value === null) return "R$ 0,00";
            return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        function toggleCompetitorSection() {
            const competitorSection = document.getElementById('competitor-section');
            const isChecked = document.getElementById('compare-toggle').checked;
            competitorSection.style.display = isChecked ? 'block' : 'none';
            calculate();
        }
        function calculate() {
            const saleValue = parseFloat(document.getElementById('saleValue').value) || 0;
            const outputDiv = document.getElementById('simulation-output');
            const isComparing = document.getElementById('compare-toggle').checked;
            if (saleValue <= 0) { outputDiv.style.display = 'none'; return; }
            outputDiv.style.display = 'flex';
            document.getElementById('simulationTitle').innerText = `Resultado para Venda de ${formatCurrency(saleValue)}`;
            const mp_rates = {};
            rateProfileIds.forEach(id => { mp_rates[id.replace('mp_', '')] = parseFloat(document.getElementById(id).value) || 0; });
            const c_rates = isComparing ? {
                pixRate: parseFloat(document.getElementById('c_pixRate').value) || 0, creditRate: parseFloat(document.getElementById('c_creditRate').value) || 0, debitRate: parseFloat(document.getElementById('c_debitRate').value) || 0,
                procFee_2_6: parseFloat(document.getElementById('c_procFee_2_6').value) || 0, procFee_7_12: parseFloat(document.getElementById('c_procFee_7_12').value) || 0, procFee_13_18: parseFloat(document.getElementById('c_procFee_13_18').value) || 0,
                psj_2_12: parseFloat(document.getElementById('c_psj_2_12').value) || 0, psj_13_18: parseFloat(document.getElementById('c_psj_13_18').value) || 0,
            } : null;
            const spotSalesTable = document.getElementById('spot-sales-table');
            let spotHtml = '';
            if (isComparing) {
                const mp_pixReceives = saleValue * (1 - mp_rates.pixRate / 100); const mp_creditReceives = saleValue * (1 - mp_rates.creditRate / 100); const mp_debitReceives = saleValue * (1 - mp_rates.debitRate / 100);
                const c_pixReceives = saleValue * (1 - c_rates.pixRate / 100); const c_creditReceives = saleValue * (1 - c_rates.creditRate / 100); const c_debitReceives = saleValue * (1 - c_rates.debitRate / 100);
                spotHtml = `<thead><tr><th>Forma</th><th class="align-right">Recebe (MP)</th><th class="align-right">Recebe (Conc.)</th><th class="align-right">Diferença</th></tr></thead><tbody>
                        <tr><td>Pix</td><td class="result-value highlight">${formatCurrency(mp_pixReceives)}</td><td class="result-value">${formatCurrency(c_pixReceives)}</td><td class="result-value difference">${formatCurrency(mp_pixReceives - c_pixReceives)}</td></tr>
                        <tr><td>Crédito à Vista</td><td class="result-value highlight">${formatCurrency(mp_creditReceives)}</td><td class="result-value">${formatCurrency(c_creditReceives)}</td><td class="result-value difference">${formatCurrency(mp_creditReceives - c_creditReceives)}</td></tr>
                        <tr><td>Débito</td><td class="result-value highlight">${formatCurrency(mp_debitReceives)}</td><td class="result-value">${formatCurrency(c_debitReceives)}</td><td class="result-value difference">${formatCurrency(mp_debitReceives - c_debitReceives)}</td></tr>
                    </tbody>`;
            } else {
                spotHtml = `<tbody>
                        <tr><td>Pix</td><td class="result-value highlight">${formatCurrency(saleValue * (1 - mp_rates.pixRate / 100))}</td></tr>
                        <tr><td>Crédito à Vista</td><td class="result-value highlight">${formatCurrency(saleValue * (1 - mp_rates.creditRate / 100))}</td></tr>
                        <tr><td>Débito</td><td class="result-value highlight">${formatCurrency(saleValue * (1 - mp_rates.debitRate / 100))}</td></tr>
                    </tbody>`;
            }
            spotSalesTable.innerHTML = spotHtml;
            const psjHeader = document.getElementById('psj-table-header'); const pcjHeader = document.getElementById('pcj-table-header');
            if (isComparing) {
                psjHeader.innerHTML = `<th>Parcelas</th><th class="align-right">Recebe (MP)</th><th class="align-right">Recebe (Conc.)</th><th class="align-right">Diferença</th>`;
                pcjHeader.innerHTML = `<th>Parcelas</th><th class="align-right">Paga (MP)</th><th class="align-right">Paga (Conc.)</th><th class="align-right">Economia</th>`;
            } else {
                psjHeader.innerHTML = `<th>Parcelas</th><th class="align-right">Juros Total</th><th class="align-right">Você Recebe</th>`;
                pcjHeader.innerHTML = `<th>Parcelas</th><th class="align-right">Valor da Parcela</th><th class="align-right">Total Pago</th>`;
            }
            const psjTableBody = document.getElementById('psj-table-body'); const pcjTableBody = document.getElementById('pcj-table-body');
            let psjHtml = ''; let pcjHtml = '';
            for (let i = 2; i <= 18; i++) {
                let mp_procFee = (i <= 6) ? mp_rates.procFee_2_6 : (i <= 12 ? mp_rates.procFee_7_12 : mp_rates.procFee_13_18);
                let mp_psj = (i <= 12) ? mp_rates.psj_2_12 : mp_rates.psj_13_18;
                const mp_totalFee = mp_procFee + (mp_psj * i);
                const mp_sellerReceives = saleValue * (1 - mp_totalFee / 100); const mp_interestValue = saleValue * (mp_totalFee / 100); const mp_clientPays = saleValue + mp_interestValue;
                if (isComparing) {
                    let c_procFee = (i <= 6) ? c_rates.procFee_2_6 : (i <= 12 ? c_rates.procFee_7_12 : c_rates.procFee_13_18);
                    let c_psj = (i <= 12) ? c_rates.psj_2_12 : c_rates.psj_13_18;
                    const c_totalFee = c_procFee + (c_psj * i);
                    const c_sellerReceives = saleValue * (1 - c_totalFee / 100); const c_interestValue = saleValue * (c_totalFee / 100); const c_clientPays = saleValue + c_interestValue;
                    psjHtml += `<tr><td class="result-label">${i}x</td><td class="result-value highlight">${formatCurrency(mp_sellerReceives)}</td><td class="result-value">${formatCurrency(c_sellerReceives)}</td><td class="result-value difference">${formatCurrency(mp_sellerReceives - c_sellerReceives)}</td></tr>`;
                    pcjHtml += `<tr><td class="result-label">${i}x</td><td class="result-value highlight">${formatCurrency(mp_clientPays / i)}</td><td class="result-value">${formatCurrency(c_clientPays / i)}</td><td class="result-value difference">${formatCurrency(c_clientPays - mp_clientPays)}</td></tr>`;
                } else {
                    psjHtml += `<tr><td class="result-label">${i}x</td><td class="result-value">${mp_totalFee.toFixed(2)}%<span class="interest-value">${formatCurrency(mp_interestValue)}</span></td><td class="result-value highlight">${formatCurrency(mp_sellerReceives)}</td></tr>`;
                    pcjHtml += `<tr><td class="result-label">${i}x</td><td class="result-value">${formatCurrency(mp_clientPays / i)}</td><td class="result-value total-value">${formatCurrency(mp_clientPays)}</td></tr>`;
                }
            }
            psjTableBody.innerHTML = psjHtml; pcjTableBody.innerHTML = pcjHtml;
        }
        calculate();
    </script>
</body>
</html>
